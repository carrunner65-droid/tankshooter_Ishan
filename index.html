<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ishan's Tank Battle Royale</title>
<style>
body{margin:0;overflow:hidden;background:#111;font-family:Arial;}
canvas{display:block;background:#333;}
.joystick{position:absolute;width:120px;height:120px;background:rgba(255,255,255,0.1);border-radius:50%;touch-action:none;}
.knob{width:60px;height:60px;background:rgba(255,255,255,0.4);border-radius:50%;position:absolute;top:30px;left:30px;}
#leftJoy{bottom:40px;left:40px;}
#rightJoy{bottom:40px;right:40px;}
#shootBtn{position:absolute;bottom:180px;right:60px;width:80px;height:80px;background:red;border-radius:50%;display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;user-select:none;touch-action:none;}
#specialBtn{position:absolute;bottom:280px;right:60px;width:100px;height:50px;background:purple;color:white;font-weight:bold;border:none;border-radius:10px;}
#startScreen,#retryScreen{position:absolute;top:0;left:0;width:100%;height:100%;background:#111;display:flex;flex-direction:column;align-items:center;justify-content:center;color:white;font-family:Arial;z-index:10;}
#startBtn,#retryBtn{padding:20px 40px;font-size:24px;cursor:pointer;}
</style>
</head>
<body>

<!-- Start screen -->
<div id="startScreen">
  <h1 style="font-size:48px;margin-bottom:20px;">Ishan's Tank Battle</h1>
  <button id="startBtn">Start Game</button>
</div>

<!-- Retry screen -->
<div id="retryScreen" style="display:none;">
  <h1 style="font-size:48px;margin-bottom:20px;">GAME OVER</h1>
  <button id="retryBtn">Try Again</button>
</div>

<canvas id="c"></canvas>
<div class="joystick" id="leftJoy"><div class="knob" id="leftKnob"></div></div>
<div class="joystick" id="rightJoy"><div class="knob" id="rightKnob"></div></div>
<div id="shootBtn">FIRE</div>
<button id="specialBtn">Special</button>

<script>
const canvas=document.getElementById("c"),ctx=canvas.getContext("2d");
let w,h;
function resize(){w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;}
window.addEventListener("resize",resize);resize();

const world={w:w*3,h:h*3};
let camera={x:0,y:0};

let gameStarted=false;
const startScreen=document.getElementById("startScreen");
document.getElementById("startBtn").addEventListener("click",()=>{
    gameStarted=true; startScreen.style.display="none";
});

// Load tank SVG
let tankSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 160" width="500" height="260" aria-labelledby="title desc" role="img">
  <title id="title">Military Tank</title>
  <desc id="desc">A flat vector illustration of a military tank with hull, turret, barrel, and tracks.</desc>
  <ellipse cx="150" cy="145" rx="110" ry="10" fill="black" opacity="0.15"/>
  <rect x="20" y="100" width="260" height="28" rx="8" ry="8" fill="#1f2d1f"/>
  <g fill="#1a1a1a" transform="translate(40,114)">
    <circle cx="0" cy="0" r="12"/>
    <circle cx="44" cy="0" r="12"/>
    <circle cx="88" cy="0" r="12"/>
    <circle cx="132" cy="0" r="12"/>
    <circle cx="176" cy="0" r="12"/>
    <circle cx="220" cy="0" r="12"/>
  </g>
  <g fill="#666" transform="translate(40,114)">
    <circle cx="0" cy="0" r="5"/>
    <circle cx="44" cy="0" r="5"/>
    <circle cx="88" cy="0" r="5"/>
    <circle cx="132" cy="0" r="5"/>
    <circle cx="176" cy="0" r="5"/>
    <circle cx="220" cy="0" r="5"/>
  </g>
  <rect x="40" y="70" width="220" height="40" rx="6" ry="6" fill="#356435"/>
  <path d="M40 70 L260 70 L280 90 L20 90 Z" fill="#2c522c"/>
  <ellipse cx="150" cy="60" rx="50" ry="22" fill="#3e7a3e"/>
  <rect x="120" y="45" width="60" height="30" rx="15" ry="15" fill="#3e7a3e"/>
  <rect x="200" y="55" width="80" height="10" rx="3" ry="3" fill="#3e7a3e"/>
  <rect x="278" y="53" width="10" height="14" rx="2" ry="2" fill="#274b27"/>
  <circle cx="135" cy="50" r="8" fill="#2f5a2f"/>
  <rect x="132" y="42" width="6" height="16" fill="#1f391f"/>
  <path d="M60 85 H240" stroke="#234923" stroke-width="2" opacity="0.6"/>
  <path d="M80 100 H220" stroke="#1d3b1d" stroke-width="1.5" opacity="0.4"/>
</svg>`;
let tankImage = new Image();
let imageLoaded = false;
let blob = new Blob([tankSvg], {type: 'image/svg+xml'});
let url = URL.createObjectURL(blob);
tankImage.src = url;
tankImage.onload = () => { imageLoaded = true; };

// Load bullet SVG
let bulletSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100">
  <circle cx="50" cy="50" r="48" fill="black"/>
  <circle cx="50" cy="50" r="35" fill="red"/>
  <circle cx="40" cy="40" r="15" fill="white" opacity="0.3"/>
</svg>`;
let bulletImage = new Image();
let bulletImageLoaded = false;
let bulletBlob = new Blob([bulletSvg], {type: 'image/svg+xml'});
let bulletUrl = URL.createObjectURL(bulletBlob);
bulletImage.src = bulletUrl;
bulletImage.onload = () => { bulletImageLoaded = true; };

// Load enemy tank SVG (red)
let enemyTankSvg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 160" width="500" height="260" aria-labelledby="title desc" role="img">
  <title id="title">Red Military Tank</title>
  <desc id="desc">A flat vector illustration of a military tank with red hull, turret, barrel, and tracks.</desc>
  <ellipse cx="150" cy="145" rx="110" ry="10" fill="black" opacity="0.15"/>
  <rect x="20" y="100" width="260" height="28" rx="8" ry="8" fill="#4b1f1f"/>
  <g fill="#331a1a" transform="translate(40,114)">
    <circle cx="0" cy="0" r="12"/>
    <circle cx="44" cy="0" r="12"/>
    <circle cx="88" cy="0" r="12"/>
    <circle cx="132" cy="0" r="12"/>
    <circle cx="176" cy="0" r="12"/>
    <circle cx="220" cy="0" r="12"/>
  </g>
  <g fill="#993333" transform="translate(40,114)">
    <circle cx="0" cy="0" r="5"/>
    <circle cx="44" cy="0" r="5"/>
    <circle cx="88" cy="0" r="5"/>
    <circle cx="132" cy="0" r="5"/>
    <circle cx="176" cy="0" r="5"/>
    <circle cx="220" cy="0" r="5"/>
  </g>
  <rect x="40" y="70" width="220" height="40" rx="6" ry="6" fill="#cc3333"/>
  <path d="M40 70 L260 70 L280 90 L20 90 Z" fill="#992222"/>
  <ellipse cx="150" cy="60" rx="50" ry="22" fill="#e06666"/>
  <rect x="120" y="45" width="60" height="30" rx="15" ry="15" fill="#e06666"/>
  <rect x="200" y="55" width="80" height="10" rx="3" ry="3" fill="#e06666"/>
  <rect x="278" y="53" width="10" height="14" rx="2" ry="2" fill="#993333"/>
  <circle cx="135" cy="50" r="8" fill="#b33a3a"/>
  <rect x="132" y="42" width="6" height="16" fill="#801919"/>
  <path d="M60 85 H240" stroke="#992222" stroke-width="2" opacity="0.6"/>
  <path d="M80 100 H220" stroke="#801919" stroke-width="1.5" opacity="0.4"/>
</svg>`;
let enemyTankImage = new Image();
let enemyTankImageLoaded = false;
let enemyTankBlob = new Blob([enemyTankSvg], {type: 'image/svg+xml'});
let enemyTankUrl = URL.createObjectURL(enemyTankBlob);
enemyTankImage.src = enemyTankUrl;
enemyTankImage.onload = () => { enemyTankImageLoaded = true; };

let player={x:world.w/2,y:world.h/2,w:40,h:30,color:'green',speed:4,angle:0,health:100,ammo:30};
let bullets=[],enemies=[],enemyMissiles=[],explosions=[],healthPacks=[],ammoPacks=[],score=0,gameOver=false;
const safeZone={x:world.w/2,y:world.h/2,r:world.w/2};

// Joystick
function setupJoystick(joy, knob){
    let touch={dx:0,dy:0};
    joy.addEventListener("touchstart",()=>{touch.active=true});
    joy.addEventListener("touchend",()=>{touch.active=false;knob.style.left="30px";knob.style.top="30px";touch.dx=0;touch.dy=0;});
    joy.addEventListener("touchmove",(e)=>{
        e.preventDefault();
        const rect=joy.getBoundingClientRect();
        let x=e.touches[0].clientX-rect.left-rect.width/2;
        let y=e.touches[0].clientY-rect.top-rect.height/2;
        const dist=Math.min(Math.sqrt(x*x+y*y),rect.width/2-30);
        const angle=Math.atan2(y,x);
        let knobX=Math.cos(angle)*dist, knobY=Math.sin(angle)*dist;
        knob.style.left=(knobX+rect.width/2-30)+"px";
        knob.style.top=(knobY+rect.height/2-30)+"px";
        touch.dx=knobX/(rect.width/2-30);
        touch.dy=knobY/(rect.height/2-30);
    },{passive:false});
    return touch;
}
let leftTouch=setupJoystick(document.getElementById("leftJoy"),document.getElementById("leftKnob"));
let rightTouch=setupJoystick(document.getElementById("rightJoy"),document.getElementById("rightKnob"));

// Keyboard
let keys={};
window.addEventListener("keydown",e=>{keys[e.key.toLowerCase()]=true;});
window.addEventListener("keyup",e=>{keys[e.key.toLowerCase()]=false;});
function handleKeyboard(){
    if(keys["w"]||keys["arrowup"]) player.y-=player.speed;
    if(keys["s"]||keys["arrowdown"]) player.y+=player.speed;
    if(keys["a"]||keys["arrowleft"]) player.x-=player.speed;
    if(keys["d"]||keys["arrowright"]) player.x+=player.speed;
    player.x=Math.max(0,Math.min(world.w-player.w,player.x));
    player.y=Math.max(0,Math.min(world.h-player.h,player.y));
}

// Shoot
document.getElementById("shootBtn").addEventListener("touchstart",()=>{shoot();});
canvas.addEventListener("mousedown",()=>{shoot();});
function shoot(){
    if(player.ammo>0){
        bullets.push({x:player.x+Math.cos(player.angle)*player.w/2,
                      y:player.y+Math.sin(player.angle)*player.h/2,
                      dx:Math.cos(player.angle)*8, dy:Math.sin(player.angle)*8, w:12, h:12});
        player.ammo--;
    }
}

// Special ability
let specialActive=false, specialCooldown=false;
document.getElementById("specialBtn").addEventListener("click",()=>{
    if(!specialActive && !specialCooldown) activateSpecial();
});
function activateSpecial(){
    specialActive=true; specialCooldown=true;
    let duration=5000;
    let angleOffset=0;
    let turretInterval=setInterval(()=>{
        angleOffset+=0.2;
        bullets.push({x:player.x+Math.cos(player.angle+angleOffset)*player.w/2,
                      y:player.y+Math.sin(player.angle+angleOffset)*player.h/2,
                      dx:Math.cos(player.angle+angleOffset)*10,
                      dy:Math.sin(player.angle+angleOffset)*10, w:12, h:12});
        bullets.push({x:player.x+Math.cos(player.angle-angleOffset)*player.w/2,
                      y:player.y+Math.sin(player.angle-angleOffset)*player.h/2,
                      dx:Math.cos(player.angle-angleOffset)*10,
                      dy:Math.sin(player.angle-angleOffset)*10, w:12, h:12});
    },200);
    setTimeout(()=>{specialActive=false; clearInterval(turretInterval);}, duration);
    setTimeout(()=>{specialCooldown=false;}, 30000);
}

// Retry
const retryScreen=document.getElementById("retryScreen");
document.getElementById("retryBtn").addEventListener("click",()=>{
    player.x = world.w/2; player.y = world.h/2; player.health=100; player.ammo=30;
    bullets=[]; enemies=[]; enemyMissiles=[]; explosions=[]; healthPacks=[]; ammoPacks=[]; score=0; gameOver=false;
    retryScreen.style.display="none"; gameStarted=true;
});

// Spawn enemies
function spawnEnemy(){enemies.push({x:Math.random()*world.w,y:Math.random()*world.h,w:40,h:30,color:'darkred',health:50,lastShot:0});}
setInterval(spawnEnemy,3000);

// Spawn pickups
function spawnHealth(){healthPacks.push({x:Math.random()*world.w,y:Math.random()*world.h,w:20,h:20});}
setInterval(spawnHealth,10000);
function spawnAmmo(){ammoPacks.push({x:Math.random()*world.w,y:Math.random()*world.h,w:20,h:20});}
setInterval(spawnAmmo,15000);

// Explosions
function createExplosion(x,y){explosions.push({x,y,radius:0,alpha:1});}

// Update
function update(){
    if(!gameStarted||gameOver) return;
    player.x+=leftTouch.dx*player.speed; player.y+=leftTouch.dy*player.speed;
    handleKeyboard();
    if(rightTouch.dx!==0||rightTouch.dy!==0) player.angle=Math.atan2(rightTouch.dy,rightTouch.dx);

    bullets.forEach((b,i)=>{b.x+=b.dx;b.y+=b.dy;if(b.x<0||b.x>world.w||b.y<0||b.y>world.h) bullets.splice(i,1);});

    healthPacks.forEach((h,i)=>{if(Math.abs(player.x-h.x)<player.w && Math.abs(player.y-h.y)<player.h){player.health=Math.min(100,player.health+30);healthPacks.splice(i,1);}});
    ammoPacks.forEach((a,i)=>{if(Math.abs(player.x-a.x)<player.w && Math.abs(player.y-a.y)<player.h){player.ammo+=10;ammoPacks.splice(i,1);}});

    enemies.forEach((e,i)=>{
        let a=Math.atan2(player.y-e.y,player.x-e.x);
        e.x+=Math.cos(a)*1.2; e.y+=Math.sin(a)*1.2;
        e.lastShot++; if(e.lastShot>90){enemyMissiles.push({x:e.x,y:e.y,dx:Math.cos(a)*5,dy:Math.sin(a)*5,w:16,h:16}); e.lastShot=0;}
        bullets.forEach((b,j)=>{if(Math.abs(b.x-e.x)<e.w && Math.abs(b.y-e.y)<e.h){e.health-=25; bullets.splice(j,1); if(e.health<=0){createExplosion(e.x,e.y);enemies.splice(i,1);score++;}}});
    });

    enemyMissiles.forEach((m,i)=>{m.x+=m.dx;m.y+=m.dy; if(Math.abs(m.x-player.x)<player.w && Math.abs(m.y-player.y)<player.h){player.health-=20;createExplosion(m.x,m.y);enemyMissiles.splice(i,1);if(player.health<=0){gameOver=true;retryScreen.style.display="flex";}} if(m.x<0||m.x>world.w||m.y<0||m.y>world.h) enemyMissiles.splice(i,1);});

    explosions.forEach((ex,i)=>{ex.radius+=1; ex.alpha-=0.05; if(ex.alpha<=0) explosions.splice(i,1);});

    camera.x=player.x-w/2; camera.y=player.y-h/2;
}

// Draw
function drawMapBackground(){
    const tileSize=100;
    for(let x=0;x<world.w;x+=tileSize){
        for(let y=0;y<world.h;y+=tileSize){
            // Base terrain colors - accessible brown/tan battlefield colors
            let baseColor = (x+y)/tileSize%2==0?'#d4c4a0':'#c8b896';
            ctx.fillStyle=baseColor;
            ctx.fillRect(x-camera.x,y-camera.y,tileSize,tileSize);
            
            // Add light sand/dirt patches (accessible beige)
            if(Math.sin(x*0.01)*Math.cos(y*0.01) > 0.3) {
                ctx.fillStyle='#e8dcc0';
                ctx.fillRect(x-camera.x+10,y-camera.y+10,tileSize-20,tileSize-20);
            }
            
            // Add darker dirt patches (accessible brown)
            if(Math.sin(x*0.015)*Math.cos(y*0.012) < -0.4) {
                ctx.fillStyle='#a08860';
                ctx.fillRect(x-camera.x+20,y-camera.y+20,tileSize-40,tileSize-40);
            }
            
            // Add dark rocks/craters (high contrast black)
            if(Math.sin(x*0.008)*Math.cos(y*0.009) > 0.6) {
                ctx.fillStyle='#2a2a2a';
                ctx.strokeStyle='#000000';
                ctx.lineWidth=2;
                ctx.beginPath();
                ctx.arc(x-camera.x+tileSize/2,y-camera.y+tileSize/2,15,0,Math.PI*2);
                ctx.fill();
                ctx.stroke();
            }
            
            // Add destroyed vegetation/debris (dark green with outline)
            if(Math.sin(x*0.012)*Math.cos(y*0.011) > 0.5) {
                ctx.fillStyle='#4a5c2a';
                ctx.strokeStyle='#000000';
                ctx.lineWidth=1;
                ctx.beginPath();
                ctx.arc(x-camera.x+25,y-camera.y+75,8,0,Math.PI*2);
                ctx.fill();
                ctx.stroke();
                ctx.beginPath();
                ctx.arc(x-camera.x+75,y-camera.y+25,6,0,Math.PI*2);
                ctx.fill();
                ctx.stroke();
            }
            
            // Add battle scorch marks (very dark patches)
            if(Math.sin(x*0.007)*Math.cos(y*0.008) < -0.7) {
                ctx.fillStyle='#1a1a1a';
                ctx.strokeStyle='#000000';
                ctx.lineWidth=1;
                ctx.fillRect(x-camera.x+30,y-camera.y+30,40,40);
                ctx.strokeRect(x-camera.x+30,y-camera.y+30,40,40);
            }
        }
    }
}
function draw(){
    if(!gameStarted) return;
    ctx.clearRect(0,0,w,h);
    drawMapBackground();
    healthPacks.forEach(h=>{ctx.fillStyle='#00ff00';ctx.strokeStyle='#000000';ctx.lineWidth=2;ctx.fillRect(h.x-camera.x,h.y-camera.y,h.w,h.h);ctx.strokeRect(h.x-camera.x,h.y-camera.y,h.w,h.h);});
    ammoPacks.forEach(a=>{ctx.fillStyle='#0066ff';ctx.strokeStyle='#000000';ctx.lineWidth=2;ctx.fillRect(a.x-camera.x,a.y-camera.y,a.w,a.h);ctx.strokeRect(a.x-camera.x,a.y-camera.y,a.w,a.h);});
    ctx.save();ctx.translate(player.x-camera.x,player.y-camera.y);ctx.rotate(player.angle);
    if(imageLoaded) {
        let tankWidth = player.w * 2;
        let tankHeight = player.h * 2;
        ctx.drawImage(tankImage, -tankWidth/2, -tankHeight/2, tankWidth, tankHeight);
    } else {
        ctx.fillStyle='#00aa00';ctx.strokeStyle='#000000';ctx.lineWidth=2;ctx.fillRect(-player.w/2,-player.h/2,player.w,player.h);ctx.strokeRect(-player.w/2,-player.h/2,player.w,player.h);
        ctx.fillStyle='#006600';ctx.fillRect(0,-5,player.w/2,10);
    }
    ctx.restore();
    enemies.forEach(e=>{
        ctx.save();
        ctx.translate(e.x-camera.x,e.y-camera.y);
        let enemyAngle = Math.atan2(player.y-e.y,player.x-e.x);
        ctx.rotate(enemyAngle);
        if(enemyTankImageLoaded) {
            let enemyTankWidth = e.w * 2;
            let enemyTankHeight = e.h * 2;
            ctx.drawImage(enemyTankImage, -enemyTankWidth/2, -enemyTankHeight/2, enemyTankWidth, enemyTankHeight);
        } else {
            ctx.fillStyle='#cc0000';ctx.strokeStyle='#000000';ctx.lineWidth=2;
            ctx.fillRect(-e.w/2,-e.h/2,e.w,e.h);ctx.strokeRect(-e.w/2,-e.h/2,e.w,e.h);
            ctx.fillStyle='#ff0000';ctx.fillRect(-e.w/2-3,-e.h/2,3,e.h);ctx.fillRect(e.w/2,-e.h/2,3,e.h);
        }
        ctx.restore();
    });
    bullets.forEach(b=>{
        if(bulletImageLoaded) {
            ctx.drawImage(bulletImage, b.x-camera.x-b.w/2, b.y-camera.y-b.h/2, b.w*2, b.h*2);
        } else {
            ctx.fillStyle='#ffdd00'; ctx.strokeStyle='#000000'; ctx.lineWidth=1;
            ctx.fillRect(b.x-camera.x,b.y-camera.y,b.w,b.h);ctx.strokeRect(b.x-camera.x,b.y-camera.y,b.w,b.h);
        }
    });
    ctx.fillStyle='#ff6600'; ctx.strokeStyle='#000000'; ctx.lineWidth=1; enemyMissiles.forEach(m=>{ctx.fillRect(m.x-camera.x,m.y-camera.y,m.w,m.h);ctx.strokeRect(m.x-camera.x,m.y-camera.y,m.w,m.h);});
    explosions.forEach(ex=>{ctx.beginPath();ctx.arc(ex.x-camera.x,ex.y-camera.y,ex.radius,0,Math.PI*2);ctx.fillStyle=`rgba(255,165,0,${ex.alpha})`;ctx.fill();});

    const mapScale=0.1,mapW=world.w*mapScale,mapH=world.h*mapScale,mapX=w-mapW-20,mapY=20;
    ctx.fillStyle='rgba(0,0,0,0.5)'; ctx.fillRect(mapX,mapY,mapW,mapH);
    ctx.strokeStyle='yellow'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(mapX+safeZone.x*mapScale,mapY+safeZone.y*mapScale,safeZone.r*mapScale,0,Math.PI*2); ctx.stroke();
    ctx.fillStyle='green'; ctx.fillRect(mapX+player.x*mapScale-3,mapY+player.y*mapScale-3,6,6);
    ctx.fillStyle='red'; enemies.forEach(e=>ctx.fillRect(mapX+e.x*mapScale-3,mapY+e.y*mapScale-3,6,6));

    ctx.fillStyle='white'; ctx.font='18px Arial';
    ctx.fillText('Health: '+Math.floor(player.health),10,20);
    ctx.fillText('Ammo: '+player.ammo,10,40);
    ctx.fillText('Score: '+score,10,60);
}

// Loop
function loop(){update();draw();requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>